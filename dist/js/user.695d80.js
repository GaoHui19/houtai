(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{704:function(e,t,n){},705:function(e,t,n){},843:function(e,t,n){"use strict";var a=n(704);n.n(a).a},844:function(e,t,n){"use strict";var a=n(705);n.n(a).a},862:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return w}));var a=n(131),r=n.n(a),l=n(190),o=n.n(l),i=n(76),s=n(15),u=n(191),c=n(707),d=n(708),m=n(709),p=n(16),f=n.n(p),b=n(719),g={id:"",account:"",name:"",roles:[],gender:"",avatar:"",mobilePhone:"",email:""},h={props:{id:{type:String,default:""},visible:{type:Boolean,default:!1}},components:{AvatarUpload:b.a},watch:{visible:function(e){e&&this.getDetail()}},data:function(){return{tableMng:u.a,userInfoBackup:f()({},g),userInfo:f()({},g),formRules:{account:[{required:!0,message:"请填写账号",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]{5,10}$/,message:"账号为5到10位的字母、数字或下划线组成",trigger:"blur"}],name:[{required:!0,message:"请填写姓名",trigger:"blur"},{max:6,message:"姓名长度不能超过6个字",trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}],mobilePhone:[{required:!0,message:"请填写手机号",trigger:"blur"},{pattern:/^1[345789]\d{9}$/,message:"手机号码格式不正确",trigger:"blur"}],email:[{type:"email",message:"邮箱格式不正确",trigger:"blur"}]},submitLoading:!1,getDetailLoading:!1}},methods:{getDetail:function(){var e=this;return o()(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.id){t.next=2;break}return t.abrupt("return");case 2:return e.getDetailLoading=!0,t.next=5,i.a.user.getDetail({id:e.id});case 5:n=t.sent,e.userInfo=f()({},n),e.userInfoBackup=f()({},n),e.getDetailLoading=!1;case 9:case"end":return t.stop()}}),t,e)})))()},handleSubmit:function(){var e,t=this;this.$refs.form.validate((e=o()(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=10;break}return t.submitLoading=!0,e.next=4,i.a.user.update({detail:t.userInfo});case 4:t.submitLoading=!1,t.handleClose(),t.$emit("onSave"),t.$message.success("提交成功"),e.next=11;break;case 10:t.$message.error("请按照正确格式填写");case 11:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)}))},handleBeforeClose:function(){var e=this;window.JSON.stringify(this.userInfoBackup)===window.JSON.stringify(this.userInfo)?this.handleClose():this.$confirm("信息修改后未提交，确认关闭？","提示",{type:"warning"}).then((function(){e.handleClose()})).catch((function(){}))},handleClose:function(){this.$refs.form.resetFields(),this.userInfo=g,this.userInfoBackup=g,this.$emit("onClose")}}},v=(n(843),n(51)),_=Object(v.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"user-edit",attrs:{title:e.id?"编辑用户":"新增用户",width:"700px",visible:e.visible,"before-close":e.handleBeforeClose}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.getDetailLoading,expression:"getDetailLoading"}],ref:"form",attrs:{model:e.userInfo,rules:e.formRules,"label-width":"70px"}},[n("el-form-item",{attrs:{label:"账号:",prop:"account"}},[n("el-input",{attrs:{placeholder:"请填写账号",clearable:"",disabled:!!e.id},model:{value:e.userInfo.account,callback:function(t){e.$set(e.userInfo,"account",t)},expression:"userInfo.account"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"姓名:",prop:"name"}},[n("el-input",{attrs:{placeholder:"请填写用户姓名",clearable:""},model:{value:e.userInfo.name,callback:function(t){e.$set(e.userInfo,"name",t)},expression:"userInfo.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色:",prop:"roles"}},[n("el-select",{attrs:{multiple:"",placeholder:"请选择用户角色"},model:{value:e.userInfo.roles,callback:function(t){e.$set(e.userInfo,"roles",t)},expression:"userInfo.roles"}},e._l(e.tableMng.getTable("role"),(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"性别:"}},[n("el-radio-group",{model:{value:e.userInfo.gender,callback:function(t){e.$set(e.userInfo,"gender",t)},expression:"userInfo.gender"}},e._l(e.tableMng.getTable("gender"),(function(t){return n("el-radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"头像:"}},[n("avatar-upload",{attrs:{action:"https://sm.ms/api/v2/upload",name:"smfile"},model:{value:e.userInfo.avatar,callback:function(t){e.$set(e.userInfo,"avatar",t)},expression:"userInfo.avatar"}})],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"手机:",placeholder:"请填写手机号",prop:"mobilePhone"}},[n("el-input",{attrs:{clearable:""},model:{value:e.userInfo.mobilePhone,callback:function(t){e.$set(e.userInfo,"mobilePhone",t)},expression:"userInfo.mobilePhone"}})],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"邮箱:",placeholder:"请填写邮箱地址",prop:"email"}},[n("el-input",{attrs:{clearable:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1)],1)],1)],1),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("提 交")])],1)],1)}),[],!1,null,"2200b966",null).exports,y={name:"User",components:{SectionTitle:c.a,ExportExcel:d.a,Pagination:m.a,Edit:_},data:function(){return{tableMng:u.a,userList:[],tableLoading:!1,queryCondition:{name:"",gender:"",roles:[],pageNumber:1,pageSize:20},total:0,selectedRows:[],editId:"",editVisible:!1}},created:function(){this.getUserList()},methods:{getUserList:function(){var e=this;return o()(r.a.mark((function t(){var n,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.tableLoading=!0,t.next=3,i.a.user.getList(e.queryCondition);case 3:n=t.sent,e.userList=n.list.map((function(t,n){return{id:t.id,index:(e.queryCondition.pageNumber-1)*e.queryCondition.pageSize+n+1,name:t.name,mobilePhone:t.mobilePhone,gender:t.gender,roles:t.roles,createDate:e.$dayjs(t.createDate).format("YYYY-MM-DD HH:mm:ss"),consume:t.consume}})),e.total=n.total,e.tableLoading=!1,a=document.querySelector(".inner-layout__page"),Object(s.f)(a,0,800);case 9:case"end":return t.stop()}}),t,e)})))()},handleEdit:function(e,t){this.editId=t?t.id:"",this.editVisible=!0},handleDelete:function(e,t){var n=this,a=[],l=[];t?(a=[t.id],l=[t.name]):(a=this.selectedRows.map((function(e){return e.id})),l=this.selectedRows.map((function(e){return e.name}))),0===l.length?this.$message.warning("请选择要删除的用户！"):this.$confirm("确定删除用户：“"+l.join("，")+"”？","提示",{type:"warning"}).then(o()(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.user.remove({id:a});case 2:n.$message.success("删除成功！"),n.getUserList();case 4:case"end":return e.stop()}}),e,n)})))).catch((function(){}))},handleSelectedRows:function(e){this.selectedRows=e},handleSave:function(){this.handleClose(),this.getUserList()},handleClose:function(){this.editVisible=!1}}},w=(n(844),Object(v.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"user-manager"},[n("div",{staticClass:"user-manager__header"},[n("div",{staticClass:"title"},[n("section-title",{attrs:{name:"用户列表"}})],1),e._v(" "),n("div",{staticClass:"operation"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleEdit}},[e._v("\n        新增用户\n      ")]),e._v(" "),n("el-button",{attrs:{type:"danger",icon:"el-icon-minus"},on:{click:e.handleDelete}},[e._v("\n        批量删除\n      ")]),e._v(" "),n("export-excel",{attrs:{"file-name":"用户数据表",header:["序号","姓名","手机","性别","角色","创建时间","累计消费额(元)"],"filter-filed":["index","name","mobilePhone","gender","role","createDate","consume"],data:e.userList}},[e._v("\n        导出表格\n      ")])],1)]),e._v(" "),n("el-form",{attrs:{inline:!0,model:e.queryCondition}},[n("el-form-item",{attrs:{label:"姓名:"}},[n("el-input",{attrs:{placeholder:"请输入用户姓名关键字",clearable:""},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"性别:"}},[n("el-select",{attrs:{placeholder:"请选择性别",clearable:""},model:{value:e.queryCondition.gender,callback:function(t){e.$set(e.queryCondition,"gender",t)},expression:"queryCondition.gender"}},e._l(e.tableMng.getTable("gender"),(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"角色:"}},[n("el-select",{attrs:{placeholder:"请选择角色",multiple:"",clearable:""},model:{value:e.queryCondition.roles,callback:function(t){e.$set(e.queryCondition,"roles",t)},expression:"queryCondition.roles"}},e._l(e.tableMng.getTable("role"),(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.getUserList}},[e._v("\n        查询\n      ")])],1)],1),e._v(" "),n("div",{staticClass:"user-manager__table"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.userList,border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectedRows}},[n("el-table-column",{attrs:{type:"selection",width:"50px"}}),e._v(" "),n("el-table-column",{attrs:{prop:"index",label:"序号",width:"80px"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e._v(" "),n("el-table-column",{attrs:{prop:"mobilePhone",label:"手机",width:"120px"}}),e._v(" "),n("el-table-column",{attrs:{prop:"gender",label:"性别",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.tableMng.getNameById("gender",t.row.gender)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"roles",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.roles,(function(a,r){return n("span",{key:a},[e._v("\n            "+e._s(e.tableMng.getNameById("role",a))+"\n            "),t.row.roles.length!==r+1?n("span",[e._v(",")]):e._e()])}))}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"createDate",label:"创建时间",sortable:""}}),e._v(" "),n("el-table-column",{attrs:{prop:"consume",label:"累计消费额(元)",width:"160px",sortable:""}}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleEdit(t.$index,t.row)}}},[e._v("\n            编辑\n          ")]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("\n            删除\n          ")])]}}])})],1)],1),e._v(" "),n("pagination",{attrs:{total:e.total,"page-number":e.queryCondition.pageNumber,"page-size":e.queryCondition.pageSize},on:{"update:pageNumber":function(t){return e.$set(e.queryCondition,"pageNumber",t)},"update:page-number":function(t){return e.$set(e.queryCondition,"pageNumber",t)},"update:pageSize":function(t){return e.$set(e.queryCondition,"pageSize",t)},"update:page-size":function(t){return e.$set(e.queryCondition,"pageSize",t)},pagination:e.getUserList}}),e._v(" "),n("edit",{attrs:{id:e.editId,visible:e.editVisible},on:{onClose:e.handleClose,onSave:e.handleSave}})],1)}),[],!1,null,"a967aa6a",null).exports)}}]);