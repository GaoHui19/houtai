(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{714:function(e,t,a){},715:function(e,t,a){},716:function(e,t,a){},814:function(e,t,a){"use strict";var i=a(714);a.n(i).a},815:function(e,t,a){"use strict";var i=a(715);a.n(i).a},816:function(e,t,a){"use strict";var i=a(716);a.n(i).a},871:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return D}));var i=a(40),l=a.n(i),r=a(76),n=a.n(r),s=a(21),c=a.n(s),o=a(128),u=a.n(o),d=a(758),m={props:{value:{type:Array,default:function(){return[]}},action:{required:!0,type:String,default:""},name:{type:String,default:"file"},sizeLimit:{type:Number,default:10},tip:{type:String,default:""}},data:function(){return{loading:!1}},methods:{beforeUpload:function(e){var t=e.size/1024/1024<this.sizeLimit;return t||this.$message.error("上传的文件小不能超过 "+this.sizeLimit+"MB!"),t&&(this.loading=!0),t},beforeRemove:function(e,t){return this.$confirm("确定删除“"+e.name+"”？")},handleSuccess:function(e,t,a){this.loading=!1,this.$emit("input",a)},handleRemove:function(e,t){this.$emit("input",t)},handlePreview:function(e){window.open(e.url)}}},p=(a(814),a(815),a(3)),f=Object(p.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-upload",{staticClass:"drag-upload",attrs:{action:e.action,name:e.name,drag:"",multiple:"","file-list":e.value,"before-upload":e.beforeUpload,"before-remove":e.beforeRemove,"on-success":e.handleSuccess,"on-remove":e.handleRemove,"on-preview":e.handlePreview}},[a("i",{staticClass:"drag-upload__icon",class:e.loading?"el-icon-loading":"el-icon-upload "}),e._v(" "),a("p",{staticClass:"drag-upload__text"},[e._v("点击或直接将文件拖到此处上传")]),e._v(" "),a("p",{staticClass:"drag-upload__tip"},[e._v("文件大小不能超过"+e._s(e.sizeLimit)+"MB！"+e._s(e.tip))])])],1)}),[],!1,null,"b127587a",null).exports,v=a(761),b=a(687),g={id:"",name:"",type:"",content:"",createDate:u()().format("YYYY-MM-DD HH:mm:ss"),imageURL:"",brief:"",accessory:[]},h={name:"ArticleEdit",props:["articleId"],components:{AvatarUpload:d.a,DragUpload:f},data:function(){return{tableMng:b.a,articleDetail:c()({},g),formRules:{name:[{required:!0,message:"请填写文章标题",trigger:"blur"},{max:20,message:"标题不能超过20个字",trigger:"blur"}],type:[{required:!0,message:"请选择文章类型",trigger:"change"}],imageURL:[{required:!0,message:"请上传标题图片"}]},submitLoading:!1}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;return n()(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.articleId){t.next=7;break}return t.next=3,e.$api.article.getDetail({id:e.articleId});case 3:a=t.sent,e.articleDetail={id:a.id,name:a.name,createDate:e.$dayjs(a.createDate).format("YYYY-MM-DD HH:mm:ss"),imageURL:a.imageURL,type:a.type,brief:a.brief,content:a.content,accessory:a.accessory},t.next=8;break;case 7:e.articleDetail=c()({},g);case 8:case"end":return t.stop()}}),t,e)})))()},handleSubmit:function(){var e,t=this;this.$refs.form.validate((e=n()(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=9;break}return t.submitLoading=!0,e.next=4,t.$api.article.update({detail:t.articleDetail});case 4:t.submitLoading=!1,t.$message.success("发布成功"),t.handleClose(),e.next=10;break;case 9:t.$message.error("请按照正确格式填写");case 10:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)}))},handleClose:function(){v.a.$emit("closeTag",this.$route.path),this.$router.push("/article/list")}}},D=(a(816),Object(p.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"article-edit"},[a("div",{staticClass:"article-edit__header"},[a("div",{staticClass:"title"},[a("section-title",{attrs:{name:e.articleId?"编辑文章":"新增文章"}})],1),e._v(" "),a("div",{staticClass:"operation"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-s-promotion",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("发布")]),e._v(" "),a("el-button",{attrs:{type:"info",icon:"el-icon-circle-close"},on:{click:e.handleClose}},[e._v("取消")])],1)]),e._v(" "),a("el-row",[a("el-col",{attrs:{lg:16}},[a("tinymce",{attrs:{height:660},model:{value:e.articleDetail.content,callback:function(t){e.$set(e.articleDetail,"content",t)},expression:"articleDetail.content"}})],1),e._v(" "),a("el-col",{attrs:{lg:8}},[a("el-form",{ref:"form",staticClass:"article-edit__form",attrs:{model:e.articleDetail,rules:e.formRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"文章标题:",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入文章标题",clearable:""},model:{value:e.articleDetail.name,callback:function(t){e.$set(e.articleDetail,"name",t)},expression:"articleDetail.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"文章类型:",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择文章类型",clearable:""},model:{value:e.articleDetail.type,callback:function(t){e.$set(e.articleDetail,"type",t)},expression:"articleDetail.type"}},e._l(e.tableMng.getTable("article"),(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"文章简介:"}},[a("el-input",{attrs:{type:"textarea",rows:3,maxlength:100,placeholder:"请输入文章简介",clearable:""},model:{value:e.articleDetail.brief,callback:function(t){e.$set(e.articleDetail,"brief",t)},expression:"articleDetail.brief"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间:",prop:"createDate"}},[a("el-input",{attrs:{disabled:""},model:{value:e.articleDetail.createDate,callback:function(t){e.$set(e.articleDetail,"createDate",t)},expression:"articleDetail.createDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"标题图片:",prop:"imageURL"}},[a("avatar-upload",{attrs:{action:"https://sm.ms/api/v2/upload",name:"smfile",round:!1,width:"80px"},model:{value:e.articleDetail.imageURL,callback:function(t){e.$set(e.articleDetail,"imageURL",t)},expression:"articleDetail.imageURL"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"附件上传:"}},[a("drag-upload",{attrs:{action:"https://jsonplaceholder.typicode.com/posts"},model:{value:e.articleDetail.accessory,callback:function(t){e.$set(e.articleDetail,"accessory",t)},expression:"articleDetail.accessory"}})],1)],1)],1)],1)],1)}),[],!1,null,"4d6eaea2",null).exports)}}]);