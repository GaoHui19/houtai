import{E as A,a as i,l as v,m as w,U as a,M as o,a8 as V,p as B,u as m,T as k,R as P,S as _,aC as x,af as n,aA as S,aB as R}from"./vue-c376286b.js";import{r as U,a as q}from"./regexp-3f5a0311.js";import{d as I,D as K}from"./index-edcb0a67.js";import{u as N}from"./useSmsCaptcha-088816da.js";import{e as $}from"./crypto-17c217c0.js";import{_ as M}from"./plugin-vue_export-helper-c27b6911.js";import"./lodash-683eb0bb.js";const T=r=>(S("data-v-4b87d1fb"),r=r(),R(),r),j={class:"forget"},L=T(()=>B("div",{class:"forget-header"},"忘记密码",-1)),z={class:"flex"},G=_(" 获取验证码 "),H={key:0},J={class:"flex justify-between"},O=_("确认"),Q=_("取消"),W=A({__name:"Password",setup(r){const p=i(),u=i({mobile:"",captcha:"",password:"",checkPassword:""}),f=i(!1),b=x(),{captchaDisabled:C,captchaCount:h,sendCaptcha:g}=N(),E={password:[{required:!0,message:"请输入密码"},{pattern:U,message:"密码需要为6~20位，且需要包含数字和字母",trigger:"blur"}],checkPassword:[{required:!0,message:"请再次输入密码"},{validator(s,e){if(e!==u.value.password)return new Error("两次输入的密码不一致")},message:"两次输入的密码不一致",trigger:"blur"}],mobile:[{required:!0,message:"手机号码不能为空"},{pattern:q,message:"手机号码格式不正确",trigger:"blur"}],captcha:[{required:!0,message:"请填写验证码"}]},y=async()=>{var s;(s=p.value)==null||s.validate(async e=>{e&&g({mobile:u.value.mobile})})},F=()=>{var s;(s=p.value)==null||s.validate(async e=>{e&&(f.value=!0,await I.portal.resetPassword({mobile:u.value.mobile,captcha:u.value.captcha,password:$(u.value.password,K)}),window.$message.success("修改成功,请使用新密码进行登录"),b.replace("/login"))})};return(s,e)=>{const d=n("el-input"),l=n("el-form-item"),c=n("el-button"),D=n("el-form");return v(),w("div",j,[L,a(D,{ref_key:"formRef",ref:p,model:u.value,rules:E,"label-width":80},{default:o(()=>[a(l,{label:"新密码",prop:"password"},{default:o(()=>[a(d,{modelValue:u.value.password,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.password=t),placeholder:"请输入新密码",type:"password"},null,8,["modelValue"])]),_:1}),a(l,{label:"确认密码",prop:"checkPassword"},{default:o(()=>[a(d,{modelValue:u.value.checkPassword,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.checkPassword=t),type:"password",placeholder:"请再次输入密码确认",onKeyup:V(F,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),a(l,{label:"手机号",prop:"mobile"},{default:o(()=>[a(d,{modelValue:u.value.mobile,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.mobile=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(l,{label:"验证码",prop:"captcha"},{default:o(()=>[B("div",z,[a(d,{modelValue:u.value.captcha,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.captcha=t),placeholder:"请输入短信验证码"},null,8,["modelValue"]),a(c,{class:"ml-5",type:"info",disabled:m(C),onClick:y},{default:o(()=>[G,m(C)?(v(),w("span",H,"("+k(m(h))+"s)",1)):P("",!0)]),_:1},8,["disabled"])])]),_:1}),a(l,null,{default:o(()=>[B("div",J,[a(c,{class:"w-25",type:"primary",loading:f.value,onClick:F},{default:o(()=>[O]),_:1},8,["loading"]),a(c,{class:"w-25 ml-5",type:"info",onClick:e[4]||(e[4]=t=>s.$router.push("/login"))},{default:o(()=>[Q]),_:1})])]),_:1})]),_:1},8,["model"])])}}}),se=M(W,[["__scopeId","data-v-4b87d1fb"]]);export{se as default};
