(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{646:function(e,t,a){},777:function(e,t,a){"use strict";var i=a(646);a.n(i).a},858:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return k}));var i=a(131),l=a.n(i),n=a(190),r=a.n(n),s=a(16),c=a.n(s),o=a(76),u=a(712),m=a(191),d=a(719),p=a(720),f=a(707),b=a(15),g={props:{id:{type:String,default:function(){return"tinymce-"+ +new Date+(1e3*Math.random()).toFixed(0)}},value:{type:String,default:""},height:{type:Number,default:500}},data:function(){return{hasInit:!1,hasInput:!1}},watch:{value:function(e){!this.hasInput&&this.hasInit&&tinymce.get(this.id).insertContent(e)}},mounted:function(){this.init()},destroyed:function(){this.destoryTinymce()},activated:function(){this.init()},deactivated:function(){this.destoryTinymce()},methods:{init:function(){var e=this;Object(b.d)("https://cdn.jsdelivr.net/npm/tinymce@5.1.2/tinymce.min.js",(function(t,a){t?e.$message.error(t.message):e.initTinymce()}))},initTinymce:function(){var e=this;tinymce.init({selector:"#"+this.id,language:"zh_CN",language_url:"/static/tinymce/langs/zh_CN.js",height:this.height,plugins:"advlist autosave autolink charmap code codesample emoticons fullscreen help hr image insertdatetime link lists media pagebreak paste preview print searchreplace table textpattern visualblocks visualchars wordcount",toolbar:"restoredraft | undo redo | styleselect | bold italic underline forecolor backcolor removeformat | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | table link image media emoticons charmap | searchreplace fullscreen preview code print",contextmenu:"copy paste link inserttable ",auto_focus:this.id,paste_enable_default_filters:!1,insertdatetime_formats:["%Y-%m-%d %H:%M:%S","%Y/%m/%d %H:%M:%S","%Y年%m月%d日 %H点%M分%S秒","%Y年%m月%d日","%H点%M分"],table_toolbar:"tableprops tablerowprops tablecellprops | tableinsertcolbefore tableinsertcolafter tabledeletecol | tableinsertrowbefore tableinsertrowafter tabledeleterow | tablemergecells tablesplitcells | tabledelete",link_context_toolbar:!0,link_assume_external_targets:!0,setup:function(e){},init_instance_callback:function(t){e.hasInit=!0,e.value&&t.insertContent(e.value),t.on("setContent keyup",(function(){e.hasInput=!0,e.$emit("input",t.getContent())}))},images_upload_handler:function(e,t,a){var i=e.blob(),l=e.base64(),n=i.type;"image/jpeg"===n?l="data:image/jpeg;base64,"+l:"image/png"===n?l="data:image/png;base64,"+l:"image/gif"===n&&(l="data:image/gif;base64,"+l);var r=new FormData;r.append("file",i),r.append("name",i.name),t(l)}})},destoryTinymce:function(){tinymce.get(this.id)&&tinymce.get(this.id).destroy()}}},h=a(51),v=Object(h.a)(g,(function(){var e=this.$createElement;return(this._self._c||e)("textarea",{directives:[{name:"loading",rawName:"v-loading",value:!this.hasInit,expression:"!hasInit"}],staticStyle:{visibility:"hidden"},attrs:{id:this.id}})}),[],!1,null,null,null).exports,y=a(123),D={id:"",name:"",type:"",content:"",createDate:a.n(y)()().format("YYYY-MM-DD HH:mm:ss"),imageURL:"",brief:"",accessory:[]},_={name:"ArticleEdit",props:["articleId"],components:{AvatarUpload:d.a,DragUpload:p.a,SectionTitle:f.a,Tinymce:v},data:function(){return{tableMng:m.a,articleDetail:c()({},D),formRules:{name:[{required:!0,message:"请填写文章标题",trigger:"blur"},{max:20,message:"标题不能超过20个字",trigger:"blur"}],type:[{required:!0,message:"请选择文章类型",trigger:"change"}],imageURL:[{required:!0,message:"请上传标题图片"}]},submitLoading:!1}},created:function(){this.getDetail()},methods:{getDetail:function(){var e=this;return r()(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.articleId){t.next=7;break}return t.next=3,o.a.article.getDetail({id:e.articleId});case 3:a=t.sent,e.articleDetail={id:a.id,name:a.name,createDate:e.$dayjs(a.createDate).format("YYYY-MM-DD HH:mm:ss"),imageURL:a.imageURL,type:a.type,brief:a.brief,content:a.content,accessory:a.accessory},t.next=8;break;case 7:e.articleDetail=c()({},D);case 8:case"end":return t.stop()}}),t,e)})))()},handleSubmit:function(){var e,t=this;this.$refs.form.validate((e=r()(l.a.mark((function e(a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=9;break}return t.submitLoading=!0,e.next=4,o.a.article.update({detail:t.articleDetail});case 4:t.submitLoading=!1,t.$message.success("发布成功"),t.handleClose(),e.next=10;break;case 9:t.$message.error("请按照正确格式填写");case 10:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)}))},handleClose:function(){u.a.$emit("closeTag",this.$route.path),this.$router.push("/article/list")}}},k=(a(777),Object(h.a)(_,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"article-edit"},[a("div",{staticClass:"article-edit__header"},[a("div",{staticClass:"title"},[a("section-title",{attrs:{name:e.articleId?"编辑文章":"新增文章"}})],1),e._v(" "),a("div",{staticClass:"operation"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-s-promotion",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("发布")]),e._v(" "),a("el-button",{attrs:{type:"info",icon:"el-icon-circle-close"},on:{click:e.handleClose}},[e._v("取消")])],1)]),e._v(" "),a("el-row",[a("el-col",{attrs:{lg:16}},[a("tinymce",{attrs:{height:660},model:{value:e.articleDetail.content,callback:function(t){e.$set(e.articleDetail,"content",t)},expression:"articleDetail.content"}})],1),e._v(" "),a("el-col",{attrs:{lg:8}},[a("el-form",{ref:"form",staticClass:"article-edit__form",attrs:{model:e.articleDetail,rules:e.formRules,"label-width":"90px"}},[a("el-form-item",{attrs:{label:"文章标题:",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入文章标题",clearable:""},model:{value:e.articleDetail.name,callback:function(t){e.$set(e.articleDetail,"name",t)},expression:"articleDetail.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"文章类型:",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择文章类型",clearable:""},model:{value:e.articleDetail.type,callback:function(t){e.$set(e.articleDetail,"type",t)},expression:"articleDetail.type"}},e._l(e.tableMng.getTable("article"),(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"文章简介:"}},[a("el-input",{attrs:{type:"textarea",rows:3,maxlength:100,placeholder:"请输入文章简介",clearable:""},model:{value:e.articleDetail.brief,callback:function(t){e.$set(e.articleDetail,"brief",t)},expression:"articleDetail.brief"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间:",prop:"createDate"}},[a("el-input",{attrs:{disabled:""},model:{value:e.articleDetail.createDate,callback:function(t){e.$set(e.articleDetail,"createDate",t)},expression:"articleDetail.createDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"标题图片:",prop:"imageURL"}},[a("avatar-upload",{attrs:{action:"https://sm.ms/api/v2/upload",name:"smfile",round:!1,width:"80px"},model:{value:e.articleDetail.imageURL,callback:function(t){e.$set(e.articleDetail,"imageURL",t)},expression:"articleDetail.imageURL"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"附件上传:"}},[a("drag-upload",{attrs:{action:"https://jsonplaceholder.typicode.com/posts"},model:{value:e.articleDetail.accessory,callback:function(t){e.$set(e.articleDetail,"accessory",t)},expression:"articleDetail.accessory"}})],1)],1)],1)],1)],1)}),[],!1,null,"8fcb12d2",null).exports)}}]);