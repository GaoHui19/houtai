import{d as f}from"./index-edcb0a67.js";import{a as y,e as T,y as b,aD as p,a5 as A}from"./vue-c376286b.js";const h=1e3,d=60*h,C=60*d,D=24*C,F=e=>{const n=Math.floor(e/D),r=Math.floor(e%D/C),a=Math.floor(e%C/d),s=Math.floor(e%d/h),t=Math.floor(e%h);return{total:e,days:n,hours:r,minutes:a,seconds:s,milliseconds:t}},R=(e,n)=>Math.floor(e/1e3)===Math.floor(n/1e3),S=e=>{let n,r,a,s;const t=y(e.time),i=T(()=>F(t.value)),u=()=>Math.max(r-Date.now(),0),o=c=>{var M,w;t.value=c,(M=e.onChange)==null||M.call(e,i.value),c===0&&(m(),(w=e.onFinish)==null||w.call(e))},l=()=>{n=requestAnimationFrame(()=>{if(a){const c=u();(!R(c,t.value)||c===0)&&o(c),t.value>0&&l()}})},g=()=>{a||(r=Date.now()+t.value,a=!0,l())},m=()=>{a=!1,cancelAnimationFrame(n)},v=(c=e.time)=>{m(),t.value=c};return b(()=>{v()}),p(()=>{s&&(a=!0,s=!1,l())}),A(()=>{a&&(m(),s=!0)}),{count:i,startCount:g,pauseCount:m,resetCount:v}},U=()=>{const e=y(!1),{count:n,startCount:r,resetCount:a}=S({time:6e3,onFinish(){u()}}),s=T(()=>n.value.seconds),t=async o=>{try{e.value=!0,o.email?await f.common.sendEmailCaptcha({email:o.email}):o.mobile&&await f.common.sendSmsCaptcha({mobile:o.mobile}),window.$message.success("验证码已发送"),r()}catch(l){e.value=!1,console.error(l)}},i=async o=>await f.common.validateCaptcha(o),u=()=>{e.value=!1,a()};return b(()=>{u()}),{captchaDisabled:e,captchaCount:s,sendCaptcha:t,validateCaptcha:i,resetCaptcha:u}};export{U as u};
